workspace:
  base: /wrkspace

pipeline:

  # these steps define a parallel execution
  # group and will fan out.

  foo:
    image: alpine:edge
    group: build
    commands:
      - echo step 1 ${TESTSTRING}
      - sleep 10
      - echo done 1 ${TESTSTRING}
  bar:
    image: alpine:edge
    group: build
    commands:
      - echo step 2 ${TESTSTRING}
      - sleep 10
      - echo done 2 ${TESTSTRING}

  # this step is not grouped with the previous
  # steps, resulting in a fan-in.

  baz:
    image: alpine:edge
    commands:
      - echo I should execute last. ${TESTSTRING}
      - echo after the prior two steps finish execution.

  # these steps define a parallel execution
  # group and will fan back out.

  qux:
    image: alpine:edge
    group: test
    commands:
      - echo step 3 ${TESTSTRING}
      - sleep 10
      - echo done 3 ${TESTSTRING}
  quux:
    image: alpine:edge
    group: test
    commands:
      - echo step 4
      - sleep 10
      - echo done 4

matrix:
  TESTSTRING:
    - integration/user
    - integration/shopping_cart
    - integration/payments
    - units
