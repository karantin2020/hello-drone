workspace:
  base: /wrkspace
  path: src/github.com/karantin2020/hello-drone

cache:
  mount:
    - foo
  
clone:
  git:
    image: plugins/git
    depth: 3

pipeline:
  # these steps define a parallel execution
  # group and will fan out.

  build:
    image: alpine:edge
    commands:
      - echo this step should not fail
      - echo DRONE_JOB_NUMBER ${DRONE_JOB_NUMBER}
      - ls /wrkspace
      - exit 0
  test:
    image: alpine:edge
    commands:
      - echo this step should execute when success
      - echo ${DRONE_COMMIT}
      - echo ${DRONE_BUILD_EVENT}
      - echo ${DRONE_JOB_NUMBER}
      - echo ${DRONE_DEPLOY_TO}
      - ls /
      - touch /wrkspace/test.txt && echo "test foo" > /wrkspace/test.txt
    when:
      status: [ success ]

  deploy:
    image: alpine:edge
    commands:
      - echo deploy step
      - exit 1
    when:
      event: deployment
      environment: production
